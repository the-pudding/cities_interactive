!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=13)}({0:function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},13:function(t,e,n){"use strict";n.r(e);var o=n(2),i=n.n(o),r={android:function(){return navigator.userAgent.match(/Android/i)},blackberry:function(){return navigator.userAgent.match(/BlackBerry/i)},ios:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},opera:function(){return navigator.userAgent.match(/Opera Mini/i)},windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return r.android()||r.blackberry()||r.ios()||r.opera()||r.windows()}},a=r;var c=Math.max(document.documentElement.clientWidth,window.innerWidth||0);function l(t){c<720&&(d3.select("#present-button").select("p").html("Population<br>in 2015"),d3.select("#compare-button").select("p").html("Compare<br>to 1990"),d3.select("#delta-button").select("p").html(function(){return'Show Change &rsquo;90-&rsquo;15 <span class="legend-change"><span style="color:#bf4d2b;">Decline</span>vs.<span style="color:#357662;">Growth</span></span>'}));var e,n,o,i,r=0,a=[{text:"<b>Take a tour.</b> Note: the taller the block, the more people it represents. Let's see the US.</b>",location:{},button:"Fly to US"},{text:"The US has about 320 million people and about 10 cities over 1 million. Let's gander at China.",location:{center:[-92.541666,29.895985],zoom:4,bearing:-1.55,pitch:60,speed:.2,easing:function(t){return t}},button:"Fly to China"},{text:"China now has 100 cities over 1M. The cluster around Hong Kong is practically three NYCs.",location:{center:[120.887528,29.17437],zoom:4,bearing:-41.58,pitch:57,speed:.2,easing:function(t){return t}},button:"Fly to Hong Kong"},{text:"This is the Pearl River Delta, where three 10M+ cities are merging.",location:{center:[113.892168,22.922493],zoom:8.01,bearing:24,pitch:58,speed:.8,easing:function(t){return t}},button:"Fly to Africa"},{text:"What happened in Asia is now set to happen in Africa. Today 1 in 6 people live on the continent.",location:{center:[27.9,-1.89],zoom:3.97,bearing:-27.2,pitch:60,speed:.2,easing:function(t){return t}},button:"Fly to Lagos"},{text:"By 2100, the world might be 1 in 3 African. This is Lagos, 13M people.",location:{center:[3.33508,6.426115],zoom:6.86,bearing:-112.8,pitch:21.5,speed:.8,easing:function(t){return t}},button:"Fly to Kinshasa"},{text:"Kinshasa has over 12M people, but grew differently, with few major roads or smaller cities connected to it.",location:{center:[15.500771,-4.345327],zoom:7.63,bearing:-30.4,pitch:60,speed:.8,easing:function(t){return t}},button:"Shrinking Cities"},{text:"This is the population change from 1990 to 2015. Population decline is in red, notably in city centers of America's rustbelt.",location:{center:[-83.539628,40.565428],zoom:7.58,bearing:-19.2,pitch:57.5,speed:.6,easing:function(t){return t}},button:""}],l=d3.select(".tour-container"),s=!0,u=d3.select(".start-screen"),p=u.select(".start-button"),d=!1,g=d3.select(".before-map-container"),f=d3.select("#main-map"),h="present",m=d3.select(".delta-map-container"),b=d3.select("#compare-map"),y=!1;function v(t){var i="width";if(c<720&&(i="height"),"delta-button"!=t&&"delta"==h&&d&&e.jumpTo({center:o.getCenter(),zoom:o.getZoom(),pitch:o.getPitch(),bearing:o.getBearing()}),"compare-button"==t?(e.resize(),g.classed("extended",!0),f.transition().duration(400).style(i,"50%"),g.transition().duration(400).style(i,"50%").on("end",function(t){h="compare",y?n.jumpTo({center:e.getCenter(),zoom:e.getZoom(),pitch:e.getPitch(),bearing:e.getBearing()}):(n=new mapboxgl.Map({container:"compare-map",style:"mapbox://styles/dock4242/cjnl0k08b88ai2slsjxzk0jii?optimize=true",center:e.getCenter(),zoom:e.getZoom(),pitch:e.getPitch(),bearing:e.getBearing()})).on("load",function(t){new mapboxgl.Compare(e,n,{}),b.style("pointer-events","all")}),e.resize()})):"compare"==h&&(g.classed("extended",!1),f.transition().duration(400).style(i,"100%"),g.transition().duration(400).style(i,"0%").on("end",function(t){n.remove(),e.resize()})),"delta-button"==t?(h="delta",d?o.jumpTo({center:e.getCenter(),zoom:e.getZoom(),pitch:e.getPitch(),bearing:e.getBearing()}):w(!1),m.transition().duration(500).style("transform","translate(0px,0px)")):m.transition().duration(500).style("transform","translate(100%,0px)").on("end",function(t){}),"present-button"==t){h="present";d3.select(".population").select("p").text("Fetching Population Count...");setTimeout(function(){j()},1e3)}else d3.select(".population").select("p").text("")}function x(t,n){if("backward"==n){if(r==a.length-1)v("present-button"),d3.select(".top-toggles").selectAll("div").select("p").classed("top-toggle-active",!1),d3.select("#present-button").select("p").classed("top-toggle-active",!0),l.select(".tour-button").style("opacity",null).style("pointer-events",null);r-=1,r=Math.max(r,0),l.select(".tour-text").html(a[r].text),l.select(".tour-button").text(a[r].button),l.select(".tour-toggle-text-current").text(r+1),0!=r&&e.flyTo(a[r].location)}else if(r!=a.length-1){if(r+=1,(r=Math.min(r,a.length-1))==a.length-1)v("delta-button"),d?o.flyTo(a[r].location):w(!0),d3.select(".top-toggles").selectAll("div").select("p").classed("top-toggle-active",!1),d3.select("#delta-button").select("p").classed("top-toggle-active",!0),l.select(".tour-button").style("opacity",0).style("pointer-events","none");l.select(".tour-text").html(a[r].text),l.select(".tour-button").text(a[r].button),l.select(".tour-toggle-text-current").text(r+1),0!=r&&e.flyTo(a[r].location)}}function w(t){console.log(t),d=!0;var n=e.getCenter(),i=e.getZoom(),r=e.getPitch(),c=e.getBearing();if(t){var l=a[a.length-1].location;console.log(l),n=l.center,i=l.zoom,r=l.pitch,c=l.bearing}(o=new mapboxgl.Map({container:"delta-map",style:"mapbox://styles/dock4242/cjnl4y42g1apa2ro2r6zjpuqz?optimize=true",center:n,zoom:i,pitch:r,bearing:c})).addControl(new mapboxgl.NavigationControl,"bottom-right")}function j(){var t=e.getBounds(),n={geodesic:!0,type:"Polygon",coordinates:[[[t.getSouthWest().lng,t.getSouthWest().lat],[t.getNorthWest().lng,t.getNorthWest().lat],[t.getNorthEast().lng,t.getNorthEast().lat],[t.getSouthEast().lng,t.getSouthEast().lat]]]};ee.data.setApiKey("AIzaSyADobnjzDCKXxK_K945fnA7bP85JXplQFE"),ee.initialize();var o=ee.Image("JRC/GHSL/P2016/POP_GPW_GLOBE_V1/2015"),i=(o=o.clip(n)).reduceRegion({reducer:ee.Reducer.sum(),geometry:n,scale:250,maxPixels:1e9}),r=d3.precisionPrefix(1e5,13e5),a=d3.formatPrefix(".".concat(r),13e5);i.evaluate(function(t){var e=t.population_count;d3.select(".population").select("p").text(a(e)+" people reside on-screen")})}mapboxgl.accessToken="pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2pjazE5eTM2NDl2aDJ3cDUyeDlsb292NiJ9.Jr__XbmAolbLyzPDj7-8kQ",console.log(t),(e=new mapboxgl.Map({container:"main-map",style:"mapbox://styles/dock4242/cjnel8krq2ltq2spteciqe2x3?optimize=true",center:[t.lon,t.lat],zoom:8,pitch:60,bearing:0})).addControl(new mapboxgl.NavigationControl,"bottom-right"),e.on("load",function(){p.classed("start-active",!0).select("p").text("See Population Data").on("click",function(t){l.selectAll(".tour-toggle-arrow").on("click",function(t,e){x(a[r],0==e?"backward":"foward")}),l.select(".tour-toggle-text-amount").text("of "+a.length),l.select(".tour-text").html(a[r].text),l.select(".tour-button").text(a[r].button).on("click",function(t){x(a[r],"forward")}),l.select(".tour-hide").on("click",function(t){s?(s=!1,l.classed("tour-hidden",!1)):(s=!0,l.classed("tour-hidden",!0))}),u.transition().duration(500).style("opacity",0).on("end",function(t){d3.select(".top-header").transition().duration(500).delay(100).style("transform","translate(0px,0px)"),d3.select(".tour-container").transition().duration(0).delay(500).on("end",function(t){d3.select(this).classed("tour-hidden",!1).classed("tour-hidden-start",!1),s=!1}),u.remove()})}),j()});var z=!1;e.on("moveend",function(){var t="Fetching Population Count...";"present"!=h&&(t=""),d3.select(".population").select("p").text(t),z?clearTimeout(i):z=!0,"present"==h&&(i=setTimeout(function(){j()},1e3))}),function(){var t=d3.select(".top-toggles");t.selectAll("div").select("p").on("click",function(e){v(d3.select(this.parentNode).attr("id")),t.selectAll("div").select("p").classed("top-toggle-active",!1),d3.select(this).classed("top-toggle-active",!0)})}()}var s={init:function(){l({lon:"-122.4374",lat:"37.7599"})},resize:function(){}},u=d3.select("body"),p=0;function d(){var t=u.node().offsetWidth;p!==t&&(p=t,s.resize())}u.classed("is-mobile",a.any()),window.addEventListener("resize",i()(d,150)),s.init()},2:function(t,e,n){(function(e){var n="Expected a function",o=NaN,i="[object Symbol]",r=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,l=/^0o[0-7]+$/i,s=parseInt,u="object"==typeof e&&e&&e.Object===Object&&e,p="object"==typeof self&&self&&self.Object===Object&&self,d=u||p||Function("return this")(),g=Object.prototype.toString,f=Math.max,h=Math.min,m=function(){return d.Date.now()};function b(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function y(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&g.call(t)==i}(t))return o;if(b(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=b(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(r,"");var n=c.test(t);return n||l.test(t)?s(t.slice(2),n?2:8):a.test(t)?o:+t}t.exports=function(t,e,o){var i,r,a,c,l,s,u=0,p=!1,d=!1,g=!0;if("function"!=typeof t)throw new TypeError(n);function v(e){var n=i,o=r;return i=r=void 0,u=e,c=t.apply(o,n)}function x(t){var n=t-s;return void 0===s||n>=e||n<0||d&&t-u>=a}function w(){var t=m();if(x(t))return j(t);l=setTimeout(w,function(t){var n=e-(t-s);return d?h(n,a-(t-u)):n}(t))}function j(t){return l=void 0,g&&i?v(t):(i=r=void 0,c)}function z(){var t=m(),n=x(t);if(i=arguments,r=this,s=t,n){if(void 0===l)return function(t){return u=t,l=setTimeout(w,e),p?v(t):c}(s);if(d)return l=setTimeout(w,e),v(s)}return void 0===l&&(l=setTimeout(w,e)),c}return e=y(e)||0,b(o)&&(p=!!o.leading,a=(d="maxWait"in o)?f(y(o.maxWait)||0,e):a,g="trailing"in o?!!o.trailing:g),z.cancel=function(){void 0!==l&&clearTimeout(l),u=0,i=s=r=l=void 0},z.flush=function(){return void 0===l?c:j(m())},z}}).call(this,n(0))}});